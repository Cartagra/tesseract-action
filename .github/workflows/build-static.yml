name: Build Static Tesseract (Alpine)

on: workflow_dispatch

jobs:
  build-alpine:
    runs-on: ubuntu-latest
    container: alpine:latest
    steps:
      - name: Install Build Tools
        run: apk add --no-cache build-base cmake git samurai autoconf automake libtool pkgconf

      - name: Install Dependencies (Static Dev Libraries)
        # Alpine 的 -dev 包通常包含静态库，但需仔细配置
        run: apk add --no-cache leptonica-dev libpng-dev libjpeg-turbo-dev tiff-dev zlib-dev

      - name: Clone Tesseract
        run: git clone --depth 1 https://github.com/tesseract-ocr/tesseract.git

      - name: Build
        run: |
          cd tesseract
          mkdir build && cd build
          # LDFLAGS="-static" 是关键，强制全静态链接
          cmake .. -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF -DCMAKE_EXE_LINKER_FLAGS="-static"
          make -j$(nproc)

      - name: Verify
        run: |
          cd tesseract/build
          ls -lh tesseract
          # 如果输出包含 "statically linked"，则成功
          file tesseract

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tesseract-alpine-static
          path: tesseract/build/tesseract
